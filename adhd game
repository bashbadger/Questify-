class WeeklyReport(BoxLayout):
    def __init__(self, app, **kwargs):
        super().__init__(orientation='vertical', padding=30, spacing=15, **kwargs)
        self.app = app

        # Header
        self.add_widget(Label(text="ðŸ“Š WEEKLY PROGRESS REPORT", font_size='24sp', bold=True))
        
        # Stats Breakdown
        xp_total = self.app.total_xp
        status = "CLAIMED!" if xp_total >= 1500 else "IN PROGRESS"
        
        self.add_widget(Label(text=f"Total XP Earned: {xp_total}"))
        self.add_widget(Label(text=f"Current Streak: {self.app.streak} Days"))
        self.add_widget(Label(text=f"Meds Consistency: {self.app.streak} / 7 Days"))
        
        # Reward Status
        color = (0, 1, 0, 1) if xp_total >= 1500 else (1, 0, 0, 1)
        self.add_widget(Label(text=f"REWARD STATUS: {status}", color=color, font_size='20sp'))

        if xp_total >= 1500:
            self.add_widget(Label(text="ðŸŽ¬ ENJOY YOUR MOVIE!", font_size='18sp', italic=True))

        # Reset Button (For Sunday nights)
        reset_btn = Button(text="START NEW WEEK (RESET XP)", size_hint_y=None, height=60, background_color=(0.7, 0, 0, 1))
        reset_btn.bind(on_release=self.reset_week)
        self.add_widget(reset_btn)

    def reset_week(self, instance):
        self.app.total_xp = 0
        self.app.save_data()
        self.app.root.clear_widgets()
        self.app.root.add_widget(MainLayout(self.app))

        
import json
import os
import random
from kivy.app import App
from kivy.uix.boxlayout import BoxLayout
from kivy.uix.label import Label
from kivy.uix.button import Button
from kivy.uix.progressbar import ProgressBar
from kivy.clock import Clock
from kivy.properties import NumericProperty, StringProperty
from plyer import vibrator # <--- Hardware access

class QuestLogApp(App):
    total_xp = NumericProperty(0)
    timer_text = StringProperty("00:00")
    active_quest = StringProperty("Select a Quest")
    
    def build(self):
        self.goal_xp = 1500
        self.seconds_remaining = 0
        self.load_data()
        return MainLayout(self)

    def load_data(self):
        if os.path.exists("save.json"):
            with open("save.json", "r") as f:
                data = json.load(f)
                self.total_xp = data.get("xp", 0)

    def save_data(self):
        with open("save.json", "w") as f:
            json.dump({"xp": self.total_xp}, f)

    def start_timer(self, quest_name, minutes, xp_value):
        self.active_quest = quest_name
        self.seconds_remaining = minutes * 60
        self.current_xp_reward = xp_value
        Clock.unschedule(self.update_timer)
        Clock.schedule_interval(self.update_timer, 1)

    def update_timer(self, dt):
        if self.seconds_remaining > 0:
            self.seconds_remaining -= 1
            mins, secs = divmod(self.seconds_remaining, 60)
            self.timer_text = f"{mins:02d}:{secs:02d}"
        else:
            self.timer_text = "TIME UP!"
            self.trigger_alert() # <--- Vibration trigger
            return False

    def trigger_alert(self):
        try:
            # Vibrates for 2 seconds when time is up
            vibrator.vibrate(2) 
        except:
            print("Vibration only works on physical Android devices")

    def complete_quest(self):
        Clock.unschedule(self.update_timer)
        self.total_xp += self.current_xp_reward
        self.save_data()
        self.timer_text = "DONE!"
        self.active_quest = "Quest Complete!"
        try:
            vibrator.vibrate(0.2) # Short "Success" buzz
        except:
            pass

# ... (MainLayout class remains the same as previous)

import json
import os
import random
from datetime import datetime, date
from kivy.app import App
# ... (keep previous imports)


    
import random

def open_loot_box(self):
    if self.total_xp >= 200:
        self.total_xp -= 200
        
        # Define the Prize Pool
        prizes = [
            "$20 Gift Card", 
            "$5 Gift Card", 
            "Streak Shield", 
            "30m Gaming Session", 
            "Favorite Snack"
        ]
        
        # Define the Weights (Total must not necessarily be 100, but easier to track)
        # 2% for $20, 8% for $5, 20% for Shield, etc.
        weights = [2, 8, 20, 30, 40] 
        
        # The "Roll"
        result = random.choices(prizes, weights=weights, k=1)[0]
        
        # Haptic Feedback: "The Drumroll"
        try:
            for _ in range(3):
                vibrator.vibrate(0.1)
                time.sleep(0.3)
            vibrator.vibrate(0.5) # The Big Reveal
        except:
            pass
            
        self.save_data()
        return result
    else:
        return "Need 200 XP to Roll!"

        